<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecteur Vidéo Combiné</title>

    <!-- CSS Imports -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/player-crimson.css">
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Nunito:300,400,600,700,800&display=swap" rel="stylesheet">
</head>
<body>

    <video id="player" playsinline controls preload="metadata" poster="https://xalaflix.eu/upload/images/bmFSbK6HMDz5moHjIkf3BatBdca.jpg">
        <source id="video-source" src="https://mayi22140.mayicloud.com/files/aa/bU4cGZhssurEmByhmkSHnXVytre4pqbAkgM.m3u8" type="video/mp4">
        <track kind="subtitles" label="Français" srclang="fr" src="sous-titres/subtitles.vtt" default>
        Votre navigateur ne prend pas en charge la balise vidéo.
    </video>

    <!-- JS Imports -->
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
    <script src="js/FWDEVPlayer.js"></script>

    <!-- Combined FWDEVPlayer and Plyr Script -->
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', () => {
            const playerControls = ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen', 'settings', 'download'];

            const player = new Plyr('#player', {
                controls: playerControls,
                quality: {
                    default: 720,
                    options: [720]
                },
                playsinline: true,
                keyboard: { focused: true, global: true },
                fullscreen: { enabled: true, fallback: true, iosNative: true },
                disableContextMenu: true,
                i18n: {
                    play: 'Play',
                    pause: 'Pause',
                    mute: 'Silence',
                    unmute: 'Son activé',
                    enableCaptions: 'Activer les sous-titres',
                    disableCaptions: 'Désactiver les sous-titres',
                    download: 'Télécharger',
                    enterFullscreen: 'Plein écran',
                    exitFullscreen: 'Sortir du plein écran',
                    settings: 'Réglages',
                    speed: 'Vitesse',
                    quality: 'Qualité',
                    loop: 'Boucle',
                    disabled: 'Désactivé',
                    enabled: 'Activé',
                    captions: 'Sous-titres',
                },
            });

            const videoElement = document.getElementById('player');
            const videoSource = document.getElementById('video-source');
            const loaderElement = document.getElementById('video-loader');
            const errorElement = document.getElementById('video-error');

            // Preload video and handle error
            videoSource.src = videoSource.src; // Reset source to begin loading
            videoElement.load(); // Load the video

            videoElement.addEventListener('canplay', function() {
                loaderElement.style.display = 'none';
                videoElement.style.display = 'block';
            });

            videoElement.addEventListener('error', function() {
                loaderElement.style.display = 'none';
                videoElement.style.display = 'none';
                errorElement.style.display = 'block';
            });

            // HLS (HTTP Live Streaming) support
            player.on('ready', function(event) {
                const instance = event.detail.plyr;
                const sources = instance.media.querySelectorAll('source');
                let hslSource = null;

                // Detect HLS source (.m3u8) if available
                sources.forEach(source => {
                    if (source.src.includes('.m3u8')) {
                        hslSource = source.src;
                    }
                });

                // Initialize HLS.js if HLS source is found and supported
                if (hslSource !== null && Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(hslSource);
                    hls.attachMedia(instance.media);
                }
            });
        });
    </script>
</body>
</html>


